---
// Terminal ç»„ä»¶ - å‘½ä»¤è¡Œæ¨¡æ‹Ÿ
---

<div class="terminal">
  <div class="terminal-header">
    <span class="terminal-dot bg-red-500"></span>
    <span class="terminal-dot bg-yellow-500"></span>
    <span class="terminal-dot bg-green-500"></span>
    <span class="ml-4 text-xs text-gray-400">sunyzhi55@portal ~ </span>
  </div>
  <div id="terminalContent" class="terminal-content text-sm">
    <div class="terminal-line text-gray-500 mb-2">
      # æ¬¢è¿æ¥åˆ°ç‡§ä¹‹é—¨æˆ·ç»ˆç«¯ã€‚è¾“å…¥ 'help' æŸ¥çœ‹å¯ç”¨å‘½ä»¤ã€‚
    </div>
    <div id="terminalOutput"></div>
    <div class="flex items-center mt-2">
      <span class="terminal-prompt mr-2">â¯</span>
      <input 
        type="text" 
        id="terminalInput" 
        class="terminal-input"
        placeholder="è¾“å…¥å‘½ä»¤..."
        autocomplete="off"
      />
    </div>
  </div>
</div>

<script>
  const terminalInput = document.getElementById('terminalInput') as HTMLInputElement;
  const terminalOutput = document.getElementById('terminalOutput');
  const terminalContent = document.getElementById('terminalContent');

  // å‘½ä»¤æ˜ å°„
  const siteMap: Record<string, string> = {
    'flame': 'https://sunyzhi55.github.io/astro-firefly-blog/',
    'flumina': 'https://sunyzhi55.github.io/vitepress-teek-blog/',
    'webgame': 'https://sunyzhi55.github.io/WebGame/'
  };

  // å¯ç”¨ç«™ç‚¹åˆ—è¡¨
  const sites = [
    { name: 'flame', desc: 'ç„° Â· Astro åšå®¢' },
    { name: 'flumina', desc: 'ç…´ Â· VitePress åšå®¢' },
    { name: 'webgame', desc: 'WebGame å°æ¸¸æˆ' }
  ];

  // å‘½ä»¤å†å²
  let commandHistory: string[] = [];
  let historyIndex = -1;

  // æ·»åŠ è¾“å‡ºè¡Œ
  function addOutput(content: string, type: 'normal' | 'success' | 'error' | 'info' = 'normal') {
    const line = document.createElement('div');
    line.className = 'terminal-line mb-1';
    
    switch (type) {
      case 'success':
        line.style.color = '#6a9955';
        break;
      case 'error':
        line.style.color = '#f44747';
        break;
      case 'info':
        line.style.color = '#569cd6';
        break;
      default:
        line.style.color = '#d4d4d4';
    }
    
    line.innerHTML = content;
    terminalOutput?.appendChild(line);
    
    // æ»šåŠ¨åˆ°åº•éƒ¨
    if (terminalContent) {
      terminalContent.scrollTop = terminalContent.scrollHeight;
    }
  }

  // æ·»åŠ å‘½ä»¤å›æ˜¾
  function addCommand(cmd: string) {
    const line = document.createElement('div');
    line.className = 'terminal-line mb-1';
    line.innerHTML = `<span class="terminal-prompt">â¯</span> <span style="color: #ce9178;">${cmd}</span>`;
    terminalOutput?.appendChild(line);
  }

  // å¤„ç†å‘½ä»¤
  function handleCommand(input: string) {
    const cmd = input.trim().toLowerCase();
    
    if (!cmd) return;
    
    // æ·»åŠ åˆ°å†å²
    commandHistory.push(cmd);
    historyIndex = commandHistory.length;
    
    // å›æ˜¾å‘½ä»¤
    addCommand(input);
    
    // è§£æå‘½ä»¤
    const parts = cmd.split(/\s+/);
    const command = parts[0];
    const args = parts.slice(1);

    switch (command) {
      case 'help':
        addOutput('å¯ç”¨å‘½ä»¤:', 'info');
        addOutput('  <span style="color:#dcdcaa">help</span>     - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯');
        addOutput('  <span style="color:#dcdcaa">ls</span>       - åˆ—å‡ºå¯è®¿é—®çš„ç«™ç‚¹');
        addOutput('  <span style="color:#dcdcaa">cd</span> &lt;ç«™ç‚¹&gt; - è·³è½¬åˆ°æŒ‡å®šç«™ç‚¹');
        addOutput('  <span style="color:#dcdcaa">clear</span>    - æ¸…ç©ºç»ˆç«¯');
        addOutput('  <span style="color:#dcdcaa">about</span>    - å…³äºæœ¬é—¨æˆ·');
        break;
        
      case 'ls':
        addOutput('å¯è®¿é—®çš„ç«™ç‚¹:', 'info');
        sites.forEach(site => {
          addOutput(`  ğŸ“ <span style="color:#4ec9b0">${site.name}</span> - ${site.desc}`);
        });
        break;
        
      case 'cd':
        if (args.length === 0) {
          addOutput('ç”¨æ³•: cd <ç«™ç‚¹å>', 'error');
          addOutput('ä½¿ç”¨ ls æŸ¥çœ‹å¯ç”¨ç«™ç‚¹');
        } else {
          const target = args[0].toLowerCase();
          if (siteMap[target]) {
            addOutput(`æ­£åœ¨è·³è½¬åˆ° ${target}...`, 'success');
            setTimeout(() => {
              window.open(siteMap[target], '_blank');
            }, 500);
          } else {
            addOutput(`æœªæ‰¾åˆ°ç«™ç‚¹: ${target}`, 'error');
            addOutput('ä½¿ç”¨ ls æŸ¥çœ‹å¯ç”¨ç«™ç‚¹', 'info');
          }
        }
        break;
        
      case 'clear':
        if (terminalOutput) {
          terminalOutput.innerHTML = '';
        }
        break;
        
      case 'about':
        addOutput('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—', 'info');
        addOutput('â•‘     ç‡§ä¹‹é—¨æˆ· Â· Personal Portal     â•‘', 'info');
        addOutput('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
        addOutput('');
        addOutput('è¿™é‡Œæ˜¯ sunyzhi55 çš„ä¸ªäººå®‡å®™å…¥å£');
        addOutput('èåˆå·¥ç¨‹ç†æ€§ä¸ä¸œæ–¹æŠ½è±¡ç¾å­¦');
        addOutput('');
        addOutput('"ç„°èµ·äºå¿ƒï¼Œç…´è—äºæ²³ï¼Œç†¹ç”Ÿäºå¤œã€‚"', 'success');
        break;
        
      case 'sudo':
        addOutput('ä½ æ²¡æœ‰è¶…çº§ç”¨æˆ·æƒé™ ğŸ˜„', 'error');
        break;
        
      case 'exit':
        addOutput('è¿™æ˜¯ä¸€ä¸ªé—¨æˆ·ï¼Œä¸æ˜¯çœŸæ­£çš„ç»ˆç«¯ã€‚', 'info');
        addOutput('ä½†æ—¢ç„¶ä½ æƒ³ç¦»å¼€...ä½•ä¸å»æ¢ç´¢å…¶ä»–ä¸–ç•Œï¼Ÿ', 'info');
        addOutput('è¾“å…¥ ls æŸ¥çœ‹å¯è®¿é—®çš„ç«™ç‚¹', 'success');
        break;
        
      default:
        addOutput(`æœªçŸ¥å‘½ä»¤: ${command}`, 'error');
        addOutput('è¾“å…¥ help æŸ¥çœ‹å¯ç”¨å‘½ä»¤', 'info');
    }
  }

  // è¾“å…¥äº‹ä»¶
  terminalInput?.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      handleCommand(terminalInput.value);
      terminalInput.value = '';
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      if (historyIndex > 0) {
        historyIndex--;
        terminalInput.value = commandHistory[historyIndex];
      }
    } else if (e.key === 'ArrowDown') {
      e.preventDefault();
      if (historyIndex < commandHistory.length - 1) {
        historyIndex++;
        terminalInput.value = commandHistory[historyIndex];
      } else {
        historyIndex = commandHistory.length;
        terminalInput.value = '';
      }
    }
  });

  // ç‚¹å‡»ç»ˆç«¯æ—¶èšç„¦è¾“å…¥æ¡†
  document.querySelector('.terminal')?.addEventListener('click', () => {
    terminalInput?.focus();
  });
</script>

<style>
  .terminal {
    font-family: "JetBrains Mono", "Fira Code", "Consolas", monospace;
    background: hsl(var(--theme-hue), 15%, 12%);
    border-radius: 12px;
    overflow: hidden;
  }

  :global([data-theme="dark"]) .terminal {
    background: hsl(var(--theme-hue), 10%, 8%);
  }

  .terminal-header {
    background: hsl(var(--theme-hue), 12%, 18%);
    padding: 8px 12px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .terminal-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
  }

  .terminal-content {
    padding: 16px;
    min-height: 200px;
    max-height: 300px;
    overflow-y: auto;
  }

  .terminal-line {
    color: #d4d4d4;
    line-height: 1.6;
  }

  .terminal-prompt {
    color: var(--color-accent-light);
  }

  .terminal-input {
    background: transparent;
    border: none;
    color: #d4d4d4;
    font-family: inherit;
    font-size: inherit;
    outline: none;
    width: calc(100% - 20px);
    caret-color: var(--color-accent);
  }

  .terminal-input::placeholder {
    color: #6a6a6a;
  }
</style>
